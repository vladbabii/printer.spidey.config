[gcode_macro SPEED_TEST]
gcode:
  {% set ooffset = 25 %}

  {% set speed = 1000 %}
  {% set acc = 500 %}
 
  {% if params.SPEED is defined %}
    {% set speed = params.SPEED|int * 60 %}
  {% endif %}
  
  {% if params.ACC is defined %}
    {% set acc = params.ACC|int %}
  {% endif %}

  {% set offset = ooffset %}

  RESPOND PREFIX="info" MSG="Testing with {speed/60|float} / {acc} "
  M204 S{acc}
  G0 X{printer.configfile.settings.stepper_x.position_endstop|int - offset} YX{printer.configfile.settings.stepper_y.position_endstop|int - offset} F500
  G0 F{speed} 
  
  G0 X{printer.configfile.settings.stepper_x.position_endstop|int - offset} Y{offset}
  G0 X{offset} Y{offset}
  G0 X{offset} Y{printer.configfile.settings.stepper_y.position_endstop|int - offset}
  G0 X{printer.configfile.settings.stepper_x.position_endstop|int - offset} Y{printer.configfile.settings.stepper_y.position_endstop|int - offset}
  
  {% set offset = ooffset * 2 %}
  G0 X{printer.configfile.settings.stepper_x.position_endstop|int - offset} Y{offset}
  G0 X{offset} Y{offset}
  G0 X{offset} Y{printer.configfile.settings.stepper_y.position_endstop|int - offset}
  G0 X{printer.configfile.settings.stepper_x.position_endstop|int - offset} Y{printer.configfile.settings.stepper_y.position_endstop|int - offset}
  
  {% set offset = ooffset * 2 %}
  G0 X{printer.configfile.settings.stepper_x.position_endstop|int - offset} Y{offset}
  G0 X{offset} Y{offset}
  G0 X{offset} Y{printer.configfile.settings.stepper_y.position_endstop|int - offset}
  G0 X{printer.configfile.settings.stepper_x.position_endstop|int - offset} Y{printer.configfile.settings.stepper_y.position_endstop|int - offset}



[gcode_macro SPEED_TEST_MOVES]
gcode:
  {% set offset = 25 %}

  {% set speed = 1000 %}
  {% set acc = 500 %}
 
  {% if params.SPEED is defined %}
    {% set speed = params.SPEED|int * 60 %}
  {% endif %}
  
  {% if params.ACC is defined %}
    {% set acc = params.ACC|int %}
  {% endif %}

  {% set iters = 1 %}
  {% if params.MOVES is defined %}
    {% set iters = params.MOVES|int %}
  {% endif %}

  RESPOND PREFIX="info" MSG="Testing {iterS} moves with {speed/60|float} speed and {acc} acceleration"

  M204 S{acc}
  G0 F{speed} 

  {% set tool = printer.toolhead %}
  {% set axisMax     = {'x':printer.configfile.settings.stepper_x.position_max|int-offset, 'y':printer.configfile.settings.stepper_y.position_max|int-offset } %}
  {% set axisMin     = {'x':printer.configfile.settings.stepper_x.position_min|int+offset, 'y':printer.configfile.settings.stepper_y.position_min|int + offset } %}
                        
  {% for f in range(0,iters) %}
      {% set x = range(axisMin.x, axisMax.x)|random %}
      {% set y = range(axisMin.y, axisMax.y)|random %}
      RESPOND PREFIX="info" MSG="Test: X={x} Y={y}"
      G0 X{x} Y{y}
  {% endfor %}